<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸŒ± GrowAGarden Calculator</title>
  <style>
    body {
      background: #e6f9ee;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2em;
    }

    h1 {
      color: #248f50;
      font-size: 2rem;
    }

    .calculator {
      background: white;
      padding: 1.5em;
      border-radius: 1em;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      max-width: 450px;
      width: 100%;
    }

    label {
      display: block;
      margin: 0.75em 0 0.25em;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 0.6em;
      margin-bottom: 1em;
      border: 1px solid #ccc;
      border-radius: 0.4em;
      font-size: 1em;
    }

    button {
      background-color: #31a76d;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    button:hover {
      background-color: #278e5a;
    }

    .result {
      font-size: 1.3em;
      font-weight: bold;
      color: #333;
      margin-top: 1em;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ± GrowAGarden Calculator</h1>
  <div class="calculator">
    <label for="fruit">ğŸŒ¿ Plant Type</label>
    <select id="fruit">
      <option>Apple</option>
      <option>Banana</option>
      <option>Beanstalk</option>
      <option>Blueberry</option>
      <option>Bamboo</option>
      <option>Cacao</option>
      <option>Cactus</option>
      <option>Carrot</option>
      <option>Celestlberry</option>
      <option>Coconut</option>
      <option>Corn</option>
      <option>Cranberry</option>
      <option>Daffodil</option>
      <option>Dragonfruit</option>
      <option>Durian</option>
      <option>Eggplant</option>
      <option>Grape</option>
      <option>Mango</option>
      <option>Moonflower</option>
      <option>Mushroom</option>
      <option>OrangeTulip</option>
      <option>Papaya</option>
      <option>Passionfruit</option>
      <option>Peach</option>
      <option>Pear</option>
      <option>Pepper</option>
      <option>Pumpkin</option>
      <option>Raspberry</option>
      <option>Soulfruit</option>
      <option>Strawberry</option>
      <option>Tomato</option>
      <option>Watermelon</option>
    </select>

    <label for="weight">âš–ï¸ Weight (kg)</label>
    <input type="number" id="weight" step="0.01" placeholder="e.g. 0.42">

    <label for="modifiers">âœ¨ Modifiers (Hold Ctrl or âŒ˜ to select multiple)</label>
    <select id="modifiers" multiple>
      <option>ğŸŒˆ Rainbow</option>
      <option>ğŸ¥‡ Gold</option>
      <option>âš¡ Shocked</option>
      <option>â„ï¸ Frozen</option>
      <option>ğŸ’§ Wet</option>
      <option>ğŸ¥¶ Chilled</option>
      <option>ğŸ« Choc</option>
      <option>ğŸŒ™ Moonlit</option>
      <option>ğŸ©¸ Bloodlit</option>
      <option>ğŸŒŸ Celestial</option>
      <option>ğŸ‰ Disco</option>
      <option>ğŸ§Ÿ Zomb</option>
      <option>ğŸ”‹ Plasma</option>
    </select>

    <button onclick="calculate()">ğŸ’° Calculate</button>
    <div class="result" id="price">Estimated Price: â€”</div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDvMCSyGIAUsMpRE-pDY3uwwMg7IMwmLig",
      authDomain: "growagardenplantcostcalculator.firebaseapp.com",
      databaseURL: "https://growagardenplantcostcalculator-default-rtdb.firebaseio.com",
      projectId: "growagardenplantcostcalculator",
      storageBucket: "growagardenplantcostcalculator.appspot.com",
      messagingSenderId: "410113480248",
      appId: "1:410113480248:web:72badb81206b458ecd38cd",
      measurementId: "G-K7XD9NMRGZ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const baseModifierWeights = {
      "ğŸŒˆ Rainbow": 3.2,
      "ğŸ¥‡ Gold": 2.3,
      "âš¡ Shocked": 5.5,
      "â„ï¸ Frozen": 4.5,
      "ğŸ’§ Wet": 1.6,
      "ğŸ¥¶ Chilled": 1.9,
      "ğŸ« Choc": 3.0,
      "ğŸŒ™ Moonlit": 2.5,
      "ğŸ©¸ Bloodlit": 2.2,
      "ğŸŒŸ Celestial": 3.6,
      "ğŸ‰ Disco": 4.8,
      "ğŸ§Ÿ Zomb": 2.9,
      "ğŸ”‹ Plasma": 3.3
    };

    async function calculate() {
      const fruit = document.getElementById("fruit").value.toLowerCase();
      const weight = parseFloat(document.getElementById("weight").value);
      const selected = Array.from(document.getElementById("modifiers").selectedOptions).map(opt => opt.value);
      const stripped = selected.map(label => label.replace(/^[^ ]+ /, ''));

      if (isNaN(weight) || weight <= 0) {
        document.getElementById("price").innerText = "â— Please enter a valid weight.";
        return;
      }

      try {
        const snap = await db.ref("learnedData").once("value");
        const data = snap.val();
        const matches = [];

        for (const key in data) {
          const entry = data[key];
          if (!entry || entry.weight <= 0) continue;

          const weightDiff = Math.abs(entry.weight - weight);
          if (entry.fruit === fruit && weightDiff <= 1.5) {
            let score = 1;
            for (const mod of stripped) {
              if (entry.modifiers.includes(mod)) score += 1.2;
              else score -= 0.4;
            }
            matches.push({
              pricePerKg: entry.price / entry.weight,
              score
            });
          }
        }

        let basePricePerKg = 100;
        if (matches.length > 0) {
          matches.sort((a, b) => b.score - a.score);
          basePricePerKg = matches[0].pricePerKg;
        }

        let multiplier = 1.0;
        for (const mod of selected) {
          if (baseModifierWeights[mod]) multiplier *= baseModifierWeights[mod];
        }

        const finalPrice = Math.round(weight * basePricePerKg * multiplier);
        document.getElementById("price").innerText =
          `Estimated Price: ${finalPrice} coins ğŸ’° (${(finalPrice / 100).toFixed(2)} Robux)`;

      } catch (err) {
        document.getElementById("price").innerText = "â— Error calculating price.";
        console.error(err);
      }
    }
  </script>
</body>
</html>
