<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GrowAGarden Plant Cost Calculator with AI Feedback & Sync</title>
  <style>
    body {
      background: linear-gradient(to bottom, #e8fff1, #c7f5df);
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2em;
    }
    h1 {
      color: #228b57;
      font-size: 2.2rem;
      margin-bottom: 1em;
      text-align: center;
    }
    .calculator {
      background: white;
      padding: 2em;
      border-radius: 1em;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 100%;
    }
    label {
      display: block;
      margin: 1em 0 0.3em;
      font-weight: 600;
      font-size: 1.05em;
      color: #333;
    }
    input, select, button {
      width: 100%;
      padding: 0.65em;
      margin-bottom: 1em;
      border: 1px solid #ccc;
      border-radius: 0.5em;
      font-size: 1em;
      box-sizing: border-box;
    }
    select[multiple] {
      height: 10em;
    }
    button {
      background-color: #34c274;
      color: white;
      font-weight: bold;
      border: none;
      transition: background 0.2s ease;
      cursor: pointer;
    }
    button:hover {
      background-color: #2aa363;
    }
    .result {
      font-size: 1.3em;
      font-weight: bold;
      color: #2c2c2c;
      margin-top: 1em;
      text-align: center;
    }
    .breakdown {
      margin-top: 1em;
      font-size: 0.9em;
      color: #444;
      background: #f7f7f7;
      padding: 1em;
      border-radius: 0.5em;
    }
    .feedback-buttons {
      margin-top: 1em;
      display: flex;
      justify-content: center;
      gap: 1em;
    }
    .feedback-buttons button {
      width: auto;
      padding: 0.5em 1em;
    }
    #correctionInput {
      display: none;
      margin-top: 1em;
    }
    footer {
      margin-top: 3em;
      font-size: 0.9em;
      color: #666;
      text-align: center;
      max-width: 600px;
    }
    #confidence {
      margin-top: 0.5em;
      font-size: 0.85em;
      color: #555;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>üåø GrowAGarden Plant Cost Calculator with AI Feedback & Sync</h1>
  <div class="calculator">
    <label for="fruit">Choose Plant</label>
    <select id="fruit">
      <option>Apple</option>
      <option>Bamboo</option>
      <option>Banana</option>
      <option>Beanstalk</option>
      <option>Blueberry</option>
      <option>Cactus</option>
      <option>Cacao</option>
      <option>Carrot</option>
      <option>Celestlberry</option>
      <option>Coconut</option>
      <option>Corn</option>
      <option>Cranberry</option>
      <option>Daffodil</option>
      <option>Dragonfruit</option>
      <option>Durian</option>
      <option>Eggplant</option>
      <option>Grape</option>
      <option>Glowshroom</option>
      <option>Mango</option>
      <option>Moonflower</option>
      <option>Mushroom</option>
      <option>Orangetulip</option>
      <option>Papaya</option>
      <option>Passionfruit</option>
      <option>Peach</option>
      <option>Pear</option>
      <option>Pepper</option>
      <option>Pumpkin</option>
      <option>Raspberry</option>
      <option>Soulfruit</option>
      <option>Strawberry</option>
      <option>Tomato</option>
      <option>Watermelon</option>
    </select>

    <label for="weight">Enter Weight (kg)</label>
    <input type="number" id="weight" step="0.01" placeholder="e.g. 0.42">

    <label for="modifiers">Select Modifiers (Ctrl/Cmd for multi)</label>
    <select id="modifiers" multiple>
      <option value="rainbow">üåà Rainbow</option>
      <option value="gold">ü•á Gold</option>
      <option value="shocked">‚ö° Shocked</option>
      <option value="frozen">‚ùÑÔ∏è Frozen</option>
      <option value="wet">üíß Wet</option>
      <option value="chilled">üßä Chilled</option>
      <option value="choc">üç´ Choc</option>
      <option value="moonlit">üåô Moonlit</option>
      <option value="bloodlit">ü©∏ Bloodlit</option>
      <option value="celestial">‚ú® Celestial</option>
      <option value="disco">üï∫ Disco</option>
      <option value="zomb">üßü Zomb</option>
      <option value="plasma">üîã Plasma</option>
    </select>

    <button id="calcBtn">üí∞ Calculate Price</button>
    <div class="result" id="price">Estimated Price: ‚Äî</div>
    <div id="confidence"></div>
    <div class="breakdown" id="breakdown"></div>

    <div class="feedback-buttons" id="feedbackButtons" style="display:none;">
      <button id="btnAccurate">‚úîÔ∏è Price Accurate</button>
      <button id="btnInaccurate">‚ùå Price Incorrect</button>
    </div>

    <div id="correctionInput">
      <label for="correctPrice">Enter Correct Price (in cents):</label>
      <input type="number" id="correctPrice" step="1" min="1" placeholder="e.g. 1000" />
      <button id="submitCorrection">Submit Correction</button>
    </div>
  </div>

  <footer>
    Not affiliated with Roblox or GrowAGarden. Made by fans üå±<br/>
    <small>AI confidence means how many times the price was confirmed accurate.</small>
  </footer>

<script>
  // Base prices & multipliers
  const basePrices = {
    strawberry: 63,
    dragonfruit: 120,
    coconut: 100,
    durian: 500,
    mushroom: 10000,
    blueberry: 180,
    tomato: 80,
    apple: 100,
    corn: 50,
    celestlberry: 2000,
  };

  const modifierMultipliers = {
    rainbow: 1.5,
    gold: 2.0,
    shocked: 2.1,
    frozen: 1.6,
    wet: 1.1,
    chilled: 1.1,
    choc: 1.4,
    moonlit: 1.4,
    bloodlit: 1.6,
    celestial: 5,
    disco: 3.5,
    zomb: 1.3,
    plasma: 1.7
  };

  // Load learned prices + confidence from localStorage
  // Format: { [plant]: { base: number, confidence: number } }
  let learnedPrices = JSON.parse(localStorage.getItem('learnedPrices') || '{}');

  const fruitSelect = document.getElementById('fruit');
  const weightInput = document.getElementById('weight');
  const modifiersSelect = document.getElementById('modifiers');
  const priceDiv = document.getElementById('price');
  const breakdownDiv = document.getElementById('breakdown');
  const confidenceDiv = document.getElementById('confidence');

  const feedbackButtons = document.getElementById('feedbackButtons');
  const btnAccurate = document.getElementById('btnAccurate');
  const btnInaccurate = document.getElementById('btnInaccurate');
  const correctionInput = document.getElementById('correctionInput');
  const correctPriceInput = document.getElementById('correctPrice');
  const submitCorrection = document.getElementById('submitCorrection');

  function getMultiplier(mods) {
    return mods.reduce((acc, mod) => acc * (modifierMultipliers[mod] || 1), 1);
  }

  let currentCalc = null; // Store last calculation info for feedback

  // Calculate price function
  function calculate() {
    const fruit = fruitSelect.value.toLowerCase();
    const weight = parseFloat(weightInput.value);
    const modifiers = Array.from(modifiersSelect.selectedOptions).map(o => o.value);

    if (isNaN(weight) || weight <= 0) {
      priceDiv.innerText = "‚ùó Please enter a valid weight.";
      feedbackButtons.style.display = 'none';
      correctionInput.style.display = 'none';
      confidenceDiv.innerText = '';
      breakdownDiv.innerHTML = '';
      return;
    }

    // Get learned base or fallback base
    const base = learnedPrices[fruit]?.base || basePrices[fruit] || 100;
    const multiplier = getMultiplier(modifiers);
    const estimatedPrice = Math.round(weight * base * multiplier);

    priceDiv.innerText = `Estimated Price: ${estimatedPrice} cents (${(estimatedPrice/100).toFixed(2)} Robux)`;

    // Show confidence if learned data exists
    if (learnedPrices[fruit]) {
      confidenceDiv.innerText = `AI Confidence: ${learnedPrices[fruit].confidence} confirmation(s)`;
    } else {
      confidenceDiv.innerText = `AI Confidence: No data yet`;
    }

    breakdownDiv.innerHTML = `
      <strong>Breakdown:</strong><br>
      Base price per kg: ${base.toFixed(2)}¬¢<br>
      Weight: ${weight}kg<br>
      Modifiers: ${modifiers.join(", ") || "None"}<br>
      Multiplier: √ó${multiplier.toFixed(2)}<br>
      Final: ${estimatedPrice} cents
    `;

    // Show feedback buttons
    feedbackButtons.style.display = 'flex';
    correctionInput.style.display = 'none';
    correctPriceInput.value = '';

    // Save current calculation for feedback use
    currentCalc = {
      fruit,
      weight,
      modifiers,
      estimatedPrice,
      base,
      multiplier
    };
  }

  // User confirms price is accurate -> update learnedPrices and localStorage
  btnAccurate.onclick = () => {
    if (!currentCalc) return;

    const { fruit, weight, estimatedPrice, base } = currentCalc;

    // Update confidence count
    if (!learnedPrices[fruit]) {
      learnedPrices[fruit] = { base, confidence: 1 };
    } else {
      learnedPrices[fruit].confidence++;
    }

    // Adjust base price by averaging with current calculation base:
    const newBase = estimatedPrice / (weight * currentCalc.multiplier);
    const oldConfidence = learnedPrices[fruit].confidence - 1;
    learnedPrices[fruit].base = (learnedPrices[fruit].base * oldConfidence + newBase) / learnedPrices[fruit].confidence;

    localStorage.setItem('learnedPrices', JSON.stringify(learnedPrices));
    alert("Thanks! Price confidence updated.");
    calculate(); // Refresh display
  };

  // User reports price is inaccurate -> show correction input
  btnInaccurate.onclick = () => {
    correctionInput.style.display = 'block';
  };

  // Submit corrected price, update learnedPrices
  submitCorrection.onclick = () => {
    if (!currentCalc) return;

    const correctPrice = parseInt(correctPriceInput.value);
    if (isNaN(correctPrice) || correctPrice <= 0) {
      alert("Please enter a valid corrected price (in cents).");
      return;
    }

    const { fruit, weight, multiplier } = currentCalc;

    // Calculate corrected base price from corrected total price
    const correctedBase = correctPrice / (weight * multiplier);

    // Update or add new learned price
    if (!learnedPrices[fruit]) {
      learnedPrices[fruit] = { base: correctedBase, confidence: 1 };
    } else {
      // Average previous base with corrected base, reset confidence (to 1)
      learnedPrices[fruit].base = correctedBase;
      learnedPrices[fruit].confidence = 1;
    }

    localStorage.setItem('learnedPrices', JSON.stringify(learnedPrices));
    alert("Thanks for your correction! AI pricing updated.");
    correctionInput.style.display = 'none';
    correctPriceInput.value = '';
    calculate();
  };

  document.getElementById('calcBtn').addEventListener('click', calculate);

  // Calculate on load with default values
  window.onload = () => {
    weightInput.value = 1;
    calculate();
  };
</script>
</body>
</html>
